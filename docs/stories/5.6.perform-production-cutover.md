# Story 5.6: Perform Production Cutover

## Status

Draft

---

## Quick Project Assessment

**Current System Context**
- [x] Offline validation and monitoring readiness gates from Stories 5.4 and 5.5 must pass before enabling any production traffic (`docs/epics/epic-5-deployment.md:260-275`).
- [x] EventBridge schedule remains disabled until go/no-go approval authorizes the cutover (`docs/epics/epic-5-deployment.md:116-149`).
- [x] Rollback relies on fast EventBridge rule disablement and container rollback because the legacy Lambda is decommissioned (`docs/epics/epic-5-deployment.md:286-336`).
- [x] Success criteria demand zero customer-facing disruption and instant monitoring visibility once traffic moves to the new Lambda (`docs/epics/epic-5-deployment.md:207-235`).

**Change Scope**
- [ ] Conduct the cutover readiness review, capture approvals, and confirm validation evidence completeness (`docs/epics/epic-5-deployment.md:260-275`).
- [ ] Enable the production EventBridge rule, observe first invocation, and verify downstream integrations succeed (`docs/epics/epic-5-deployment.md:116-149`).
- [ ] Execute immediate post-cutover health checks and alarm drills to ensure monitoring, notifications, and rollback paths behave as expected (`docs/epics/epic-5-deployment.md:297-336`).
- [ ] Document actions, timestamps, and evidence in `VALIDATION.md` and the deployment runbook for hand-off to post-cutover monitoring (Story 5.7) (`docs/epics/epic-5-deployment.md:231-235`).

---

## Story

**As a** release captain overseeing the migration,  
**I want** to perform the production cutover by enabling the new container-based Lambda and validating its first live executions,  
**so that** customer notifications continue without interruption and stakeholders have auditable proof the go-live succeeded.

---

## Story Context

- Go/no-go checkpoint #2 requires recorded approval and validation evidence before traffic moves to the new Lambda (`docs/epics/epic-5-deployment.md:260-275`).
- EventBridge scheduling must be toggled from `DISABLED` to `ENABLED` only after confirming prerequisites and communicating the cutover window (`docs/epics/epic-5-deployment.md:116-149`).
- Monitoring dashboards, alarms, and Telegram alerts must be active to detect issues within the <10 minute detection SLA defined for rollback procedures (`docs/epics/epic-5-deployment.md:297-336`).
- Rollback SLA mandates disabling the EventBridge rule and redeploying the previous container (if needed) within 35 minutes if critical issues appear (`docs/epics/epic-5-deployment.md:314-336`).
- Evidence from the cutover phase feeds post-cutover monitoring (Story 5.7) and final epic close-out documentation (`docs/epics/epic-5-deployment.md:231-235`).

---

## Acceptance Criteria

**Functional Requirements**
1. Go/no-go meeting minutes, stakeholder approvals, and validation evidence summary are recorded prior to enabling production traffic, referencing `VALIDATION.md` and readiness reports (`docs/epics/epic-5-deployment.md:260-275`).
2. EventBridge rule `naver-sms-automation-trigger` is enabled with documented command output, and the first scheduled Lambda execution completes successfully with DynamoDB writes, SENS SMS dispatch, and Telegram notification confirmation logs (`docs/epics/epic-5-deployment.md:116-149`, `docs/epics/epic-5-deployment.md:207-214`).
3. No customer-impacting discrepancies are detected during or immediately after the first execution, confirmed via CloudWatch metrics, SENS delivery stats, and comparison telemetry (`docs/epics/epic-5-deployment.md:207-235`).

**Integration Requirements**
4. CloudWatch dashboard widgets and alarms remain in healthy states (no triggered alarms beyond informational), with screenshots or exports captured as evidence of monitoring readiness (`docs/epics/epic-5-deployment.md:297-322`).
5. Telegram alerting channel receives cutover start, success, and escalation notifications, and contact escalation paths are confirmed (`docs/epics/epic-5-deployment.md:321-349`).
6. Rollback drill confirming EventBridge disablement and previous container redeploy instructions is executed or dry-run validated within the defined <35 minute end-to-end SLA (`docs/epics/epic-5-deployment.md:314-336`).

**Quality Requirements**
7. `VALIDATION.md` gains a cutover section with timestamps, AWS command transcripts, alarm states, and approval artifacts complying with audit expectations (`docs/epics/epic-5-deployment.md:231-235`).
8. `docs/ops/runbook.md` is updated with production cutover steps, communication templates, and rollback escalation contacts aligned to the new container deployment (`docs/epics/epic-5-deployment.md:314-336`, `docs/ops/runbook.md:1`).
9. Risk log or decision register captures any deviations, mitigations, and lessons learned to inform Story 5.7 monitoring activities (`docs/epics/epic-5-deployment.md:336-352`).

---

## Tasks / Subtasks

- [ ] Task 1: Confirm cutover readiness (AC1, AC7)
  - [ ] Review validation evidence from Story 5.5, collect approvals, and schedule the cutover window (`docs/epics/epic-5-deployment.md:260-275`).
  - [ ] Update `VALIDATION.md` with readiness checklist, go/no-go decision, and pre-cutover state snapshots (`docs/epics/epic-5-deployment.md:231-235`).

- [ ] Task 2: Execute production cutover (AC2, AC3, AC5)
  - [ ] Enable EventBridge rule via AWS CLI (or console), store CLI transcript in `docs/validation/story-5.6/eventbridge-enable.txt`, and broadcast start/success/escalation Telegram messages following the escalation contacts in `docs/ops/runbook.md:390-404`; confirm acknowledgement in Slack `#alerts` and record message IDs (`docs/epics/epic-5-deployment.md:116-149`, `docs/epics/epic-5-deployment.md:321-349`).
  - [ ] Observe the first Lambda invocation, verifying DynamoDB, SENS, and Telegram integrations produced expected results with no customer disruption and document findings in `docs/validation/story-5.6/first-run-summary.md` (`docs/epics/epic-5-deployment.md:207-235`).

- [ ] Task 3: Verify monitoring and rollback posture (AC4, AC6)
  - [ ] Capture CloudWatch dashboard/alarm evidence showing healthy state before and after cutover, noting any anomalies, and save exports to `docs/validation/story-5.6/` (`docs/epics/epic-5-deployment.md:297-322`).
  - [ ] Perform rollback drill or tabletop validating EventBridge disablement and container redeploy steps within SLA, documenting timings in `docs/validation/story-5.6/rollback-drill.txt` (`docs/epics/epic-5-deployment.md:314-336`).

- [ ] Task 4: Finalize documentation and hand-off (AC7, AC8, AC9)
  - [ ] Append cutover timeline, approvals, and evidence to `VALIDATION.md` under `## Validation Evidence: Story 5.6 - Production Cutover` and update `docs/ops/runbook.md` “Production Cutover Procedure” subsection with final steps executed (`docs/epics/epic-5-deployment.md:231-235`, `docs/ops/runbook.md:1`).
  - [ ] Log risks, mitigations, and lessons learned in the Epic 5 risk table (`docs/epics/epic-5-deployment.md:201-352`) and brief post-cutover monitoring owners for Story 5.7 with runbook references (`docs/ops/runbook.md:360-404`).

---

## Dev Notes

- **Cutover Prerequisites:** Confirm Stories 5.4 and 5.5 evidence is marked complete in `VALIDATION.md` and readiness checklists are green before proceeding (`docs/epics/epic-5-deployment.md:260-275`, `VALIDATION.md`).
- **EventBridge Control:** Production schedule is `naver-sms-automation-trigger`. Use the AWS CLI from release workstation:
  ```bash
  aws events enable-rule --name naver-sms-automation-trigger --region ap-northeast-2
  aws events disable-rule --name naver-sms-automation-trigger --region ap-northeast-2  # rollback drill
  aws lambda invoke \
    --function-name naverplace_send_inform_v2 \
    --invocation-type RequestResponse \
    --log-type Tail \
    --payload '{\"dry_run\": false}' \
    out/first-cutover-response.json \
    --region ap-northeast-2
  ```
  Capture command output as `docs/validation/story-5.6/eventbridge-enable.txt` and `eventbridge-disable.txt` for audit (`docs/epics/epic-5-deployment.md:116-149`).
- **Monitoring Evidence:** Export CloudWatch dashboard widgets (`naver-sms-automation-dashboard`) before and after cutover as PNGs and store inside `docs/validation/story-5.6/` with filenames `dashboard-pre-cutover.png` and `dashboard-post-cutover.png` (`docs/epics/epic-5-deployment.md:297-322`, `docs/ops/runbook.md:1-58`).
- **Notification Flow:** Follow the escalation playbook in `docs/ops/runbook.md:69-116` and `docs/ops/runbook.md:390-404`. Send three Telegram messages (start, success, escalation test) and confirm escalation contact acknowledges in Slack `#alerts`. Record screenshots or message IDs in `docs/validation/story-5.6/notifications.md` (AC5).
- **Documentation Targets:** Append a new section titled `## Validation Evidence: Story 5.6 - Production Cutover` near the top of `VALIDATION.md` with timestamps, CLI transcripts, dashboard exports, and approval summaries. Update `docs/ops/runbook.md` by adding/refreshing the “Production Cutover Procedure” subsection under the Maintenance section with the precise steps executed (`docs/ops/runbook.md:320-404`).
- **Risk & Decision Logging:** Add cutover deviations or mitigations to the “Risks & Mitigation” table inside `docs/epics/epic-5-deployment.md` (update or append rows) and, if decisions arise, capture them in the “Go/No-Go Decision Points” notes for traceability (`docs/epics/epic-5-deployment.md:352-390`).
- **Rollback Readiness:** Previous container image digest is recorded in Story 5.1 (`docs/stories/5.1.deploy-to-ecr.md:144-189`). Be prepared to retag and redeploy it if rollback triggered; document the dry-run timing in `docs/validation/story-5.6/rollback-drill.txt`.

### Testing

- **Observability Checks:** Use CloudWatch dashboards and alarm histories to confirm metrics and thresholds remained healthy across the cutover window (`docs/epics/epic-5-deployment.md:297-322`).
- **Functional Spot Checks:** Trigger manual booking scenarios (if feasible) or review SENS/Telia logs to ensure real customer flows succeeded post-cutover (`docs/epics/epic-5-deployment.md:207-235`).
- **Rollback Tabletop:** Simulate disabling EventBridge and redeploying previous image, capturing elapsed time to ensure SLA adherence (`docs/epics/epic-5-deployment.md:314-336`).
- **Audit Evidence:** Preserve CLI transcripts, screenshots, and approval artifacts within `docs/validation/story-5.6/` and summarize them in `VALIDATION.md` for QA gate review and compliance (`docs/epics/epic-5-deployment.md:231-235`).

---

## Open Questions

1. Do additional stakeholder communication channels (e.g., Slack, email) need explicit message templates alongside Telegram alerts during cutover? (`docs/epics/epic-5-deployment.md:321-349`)
2. Can the rollback drill be executed in production during the cutover window, or should it be validated in staging with documented equivalency? (`docs/epics/epic-5-deployment.md:314-336`)
3. Are there any regulatory or audit notifications required to confirm the SMS service migration when traffic moves to the new Lambda? (`docs/epics/epic-5-deployment.md:231-235`)

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-21 | 0.1 | Initial draft aligned to Epic 5 cutover requirements | Bob (Scrum Master) |

---

## Dev Agent Record

### Agent Model Used

- Pending assignment.

### Debug Log References

- Pending implementation.

### Completion Notes List

- Pending implementation.

### File List

- Pending implementation.

---

## QA Results

- Pending QA review.
